{
    "version": "1.0.1173",
    "description": "A voice, video, and text communication platform, offering early access to the newest features via the Public Test Build (PTB) prior to their general release.",
    "homepage": "https://discord.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://discord.com/terms"
    },
    "architecture": {
        "64bit": {
            "url": "https://ptb.dl2.discordapp.net/distro/app/ptb/win/x64/1.0.1173/DiscordPTBSetup.exe",
            "hash": "7f51940582cd4123876bf9bf6def5c00132bbeb3df86011460c7e2d6deca2cdc"
        }
    },
    "installer": {
        "script": [
            "ensure \"$dir\\packages\" | Out-Null",
            "Expand-7zipArchive -Path \"$dir\\$fname\" -Removal",
            "$archive_file = Get-ChildItem -Path $dir -Filter '*.nupkg' -File | ForEach-Object -MemberName FullName",
            "Expand-7zipArchive -Path $archive_file -DestinationPath \"$dir\\app-$version\" -ExtractDir 'lib\\net45' -Removal",
            "Move-Item -Path \"$dir\\app-$version\\installer.db\" -Destination $dir -Force",
            "Move-Item -Path \"$dir\\RELEASES\" -Destination \"$dir\\packages\" -Force",
            "Copy-Item -Path \"$dir\\app-$version\\app.ico\" -Destination $dir"
        ]
    },
    "shortcuts": [
        [
            "Update.exe",
            "Discord PTB",
            "--processStart DiscordPTB.exe",
            "app.ico"
        ]
    ],
    "checkver": {
        "script": [
            "Add-Type -AssemblyName System.Net.Http",
            "$params = [ordered]@{ channel = 'ptb'; platform = 'win'; arch = 'x64' }",
            "$base_url = 'https://discord.com/api/downloads/distributions/app/installers/latest'",
            "$query_string = ($params.Keys | ForEach-Object -Process { \"$_=$($params[$_])\" }) -join '&'",
            "$download_url = $base_url + '?' + $query_string",
            "$http_handler = New-Object -TypeName System.Net.Http.HttpClientHandler",
            "$http_handler.AllowAutoRedirect = $true",
            "$client = [System.Net.Http.HttpClient]::new($http_handler)",
            "$request = New-Object -TypeName System.Net.Http.HttpRequestMessage -ArgumentList 'HEAD', $download_url",
            "$response = $client.SendAsync($request).Result",
            "Write-Output $response.RequestMessage.RequestUri.AbsoluteUri"
        ],
        "regex": "x64/([\\d.]+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://ptb.dl2.discordapp.net/distro/app/ptb/win/x64/$version/DiscordPTBSetup.exe"
            }
        }
    }
}
