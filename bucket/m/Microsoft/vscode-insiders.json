{
    "version": "1.109.0-f3a7ce3",
    "description": "Visual Studio Code Insiders is a lightweight yet powerful, cross-platform source code editor providing rich support for development, debugging, and extension-based customization for modern web and cloud workloads.",
    "homepage": "https://code.visualstudio.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://code.visualstudio.com/license/insiders"
    },
    "notes": [
        "To register file associations, please execute the following command:",
        "- `reg import \"$dir\\register-file-associations.reg\"`",
        "To register the context menu entry, please execute the following command:",
        "- `reg import \"$dir\\register-context-menu.reg\"`",
        "To register the installed program entry (required for integration with other applications), please execute the following command:",
        "- `reg import \"$dir\\register-installed-program.reg\"`"
    ],
    "architecture": {
        "64bit": {
            "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/f3a7ce35470b1ae3fb47177d35e3964a24094372/VSCode-win32-x64-1.109.0-insider.zip",
            "hash": "ef34534ac684e53455539c4a7f0137d2a648c1924fd7342b20c5d32367edf367"
        },
        "arm64": {
            "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/f3a7ce35470b1ae3fb47177d35e3964a24094372/VSCode-win32-arm64-1.109.0-insider.zip",
            "hash": "4d2dc9208ea5a71a07029ea13f22ddcf670f2750c8722c54e2a1a1d744c260ab"
        }
    },
    "pre_install": [
        "ensure \"$dir\\resources\\app\\resources\\win32\" | Out-Null",
        "$build_dir = Get-ChildItem -Path $dir -Directory |",
        "        Where-Object { $_.Name -match '^[a-f0-9]{7,}$' } | ForEach-Object -MemberName FullName",
        "if ($null -ne $build_dir -and (Test-Path -Path \"$build_dir\\resources\\app\\resources\\win32\\*\")) {",
        "    $resources_dir = \"$dir\\resources\\app\\resources\\win32\"",
        "    $original_resources_dir = \"$build_dir\\resources\\app\\resources\\win32\"",
        "    Copy-Item -Path \"$original_resources_dir\\*\" -Destination \"$dir\\resources\\app\\resources\\win32\"",
        "}",
        "$data_dir = \"$dir\\data\" -replace '\\\\', '/'",
        "$extensions_file = \"$env:USERPROFILE\\.vscode-insiders\\extensions\\extensions.json\"",
        "if (-not (Test-Path -Path $extensions_file -PathType Leaf)) { return }",
        "$cfg = Get-Content -Path $extensions_file -Encoding utf8 | ConvertFrom-Json",
        "$cfg | ForEach-Object -Process {",
        "    $_.location.PSObject.Properties.Remove('_sep')",
        "    $_.location.PSObject.Properties.Remove('fsPath')",
        "    $_.location.PSObject.Properties.Remove('external')",
        "    $_.location.path = $_.location.path -replace '(?<=/).+(?=/extensions)', $data_dir",
        "    if (-not $_.identifier.uuid -and $_.metadata.id) {",
        "        $_.identifier | Add-Member -NotePropertyName uuid -NotePropertyValue $_.metadata.id",
        "    }",
        "}",
        "$cfg | ConvertTo-Json -Depth 5 -Compress | Set-Content -Path $extensions_file -NoNewline -Encoding utf8"
    ],
    "post_install": [
        "$vscode_insiders_dir = $dir -replace '\\\\', '\\\\'",
        "Get-ChildItem -Path \"$bucketsdir\\$bucket\\scripts\\$app\" -Filter '*.reg' -File | ForEach-Object -Process {",
        "    $content = Get-Content -Path $_.FullName -Encoding utf8",
        "    if ($global) {",
        "        $content = $content -replace 'HKEY_CURRENT_USER', 'HKEY_LOCAL_MACHINE'",
        "        $content = $content -replace '(?<={).+(?=}_is1)', '1287CAD5-7C8D-410D-88B9-0D1EE4A83FF2'",
        "    }",
        "    $content -replace '{{vscode_insiders_dir}}', $vscode_insiders_dir | Set-Content -Path \"$dir\\$($_.Name)\" -Encoding unicode",
        "}",
        "if (-not (Test-Path -Path \"$dir\\data\\user-data\\*\") -and (Test-Path -Path \"$env:AppData\\Code - Insiders\\*\")) {",
        "    Write-Host \"`nINFO  Migrating user data to '$dir\\data'...\" -ForegroundColor DarkGray",
        "    Copy-Item -Path \"$env:AppData\\Code - Insiders\\*\" -Destination \"$dir\\data\\user-data\" -Force -Recurse",
        "}",
        "'argv.json', 'extensions' | ForEach-Object -Process {",
        "    if (-not (Test-Path -Path \"$dir\\data\\$_\") -and (Test-Path -Path \"$env:USERPROFILE\\.vscode-insiders\\$_\")) {",
        "        Write-Host \"INFO  Migrating $_ to '$dir\\data'...\" -ForegroundColor DarkGray",
        "        Copy-Item -Path \"$env:USERPROFILE\\.vscode-insiders\\$_\" -Destination \"$dir\\data\\$_\" -Force -Recurse",
        "    }",
        "}",
        "$remove_list = 'argv.json', 'extensions' | ForEach-Object -Process { \"$env:USERPROFILE\\.vscode-insiders\\$_\" }",
        "$remove_list + @(\"$env:AppData\\Code - Insiders\") | Remove-Item -Recurse -Force -ErrorAction SilentlyContinue",
        "$extensions_file = \"$dir\\data\\extensions\\extensions.json\"",
        "if (Test-Path -Path $extensions_file -PathType Leaf) {",
        "    Write-Host \"`nINFO  Adjusting path in extensions file...\" -ForegroundColor DarkGray",
        "    $cfg = Get-Content -Path $extensions_file -Encoding utf8",
        "    $replace_regex = '(?<=vscode[/\\\\]+)[\\d.]+(?=[/\\\\]+data[/\\\\]+extensions)'",
        "    $cfg -replace $replace_regex, $version | Set-Content -Path $extensions_file -NoNewline -Encoding utf8",
        "}"
    ],
    "env_add_path": "bin",
    "shortcuts": [
        [
            "Code - Insiders.exe",
            "Visual Studio Code - Insiders"
        ]
    ],
    "persist": "data",
    "uninstaller": {
        "script": [
            "if ($cmd -ne 'uninstall') { return }",
            "Get-ChildItem -Path $dir -Filter 'un*.reg' -File | ForEach-Object -Process {",
            "    $registry_file = \"`\"{0}`\"\" -f $_.FullName",
            "    Start-Process -FilePath 'reg.exe' -ArgumentList @('import', $registry_file) -WindowStyle Hidden -Wait",
            "}"
        ]
    },
    "checkver": {
        "url": "https://update.code.visualstudio.com/api/update/win32-x64-archive/insider/latest",
        "jsonpath": "$.url",
        "regex": "insider/(?<commit>(?<suffix>[a-f0-9]{7})[^/]+)/VSCode-win32-x64-(?<prefix>[\\d.]+)",
        "replace": "${prefix}-${suffix}"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/$matchCommit/VSCode-win32-x64-$matchHead-insider.zip",
                "hash": {
                    "url": "https://update.code.visualstudio.com/api/versions/$matchHead-insider/win32-x64-archive/insider",
                    "jsonpath": "$.sha256hash"
                }
            },
            "arm64": {
                "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/$matchCommit/VSCode-win32-arm64-$matchHead-insider.zip",
                "hash": {
                    "url": "https://update.code.visualstudio.com/api/versions/$matchHead-insider/win32-arm64-archive/insider",
                    "jsonpath": "$.sha256hash"
                }
            }
        }
    }
}
