{
    "version": "1.108.0-7f08f95",
    "description": "Visual Studio Code Insiders is a lightweight yet powerful, cross-platform source code editor providing rich support for development, debugging, and extension-based customization for modern web and cloud workloads.",
    "homepage": "https://code.visualstudio.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://code.visualstudio.com/license/insiders"
    },
    "notes": [
        "To register file associations, please execute the following command:",
        "- `reg import \"$dir\\register-file-associations.reg\"`",
        "To register the context menu entry, please execute the following command:",
        "- `reg import \"$dir\\register-context-menu.reg\"`",
        "To register the installed program entry (required for integration with other applications), please execute the following command:",
        "- `reg import \"$dir\\register-installed-program.reg\"`"
    ],
    "architecture": {
        "64bit": {
            "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/7f08f95ad54782bd242f5536470b330282197333/VSCode-win32-x64-1.108.0-insider.zip",
            "hash": "7f49a25143325ff1381df4e8e155103fd66e13f37be41bbd5cedbfa5e9a3b750"
        },
        "arm64": {
            "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/7f08f95ad54782bd242f5536470b330282197333/VSCode-win32-arm64-1.108.0-insider.zip",
            "hash": "97576068052e86b101cc7767eaf75b2fc8f2b607daae84baa73721084db9090c"
        }
    },
    "pre_install": [
        "ensure \"$dir\\resources\\app\\resources\\win32\" | Out-Null",
        "$commit_dir = (Get-ChildItem -Path $dir -Directory | Where-Object { $_.Name -match '^[a-f0-9]{7,}$' }).FullName",
        "if ($null -ne $commit_dir -and (Test-Path \"$commit_dir\\resources\\app\\resources\\win32\\*\")) {",
        "    $original_resources_dir = \"$commit_dir\\resources\\app\\resources\\win32\"",
        "    $resources_dir = \"$dir\\resources\\app\\resources\\win32\"",
        "    Copy-Item -Path \"$original_resources_dir\\*\" -Destination \"$dir\\resources\\app\\resources\\win32\"",
        "}",
        "$data_path = (Join-Path -Path $dir -ChildPath 'data') -replace '\\\\', '/'",
        "$extensions_file = \"$env:USERPROFILE\\.vscode-insiders\\extensions\\extensions.json\"",
        "if (-not (Test-Path $extensions_file)) { return }",
        "$cfg = Get-Content -Path $extensions_file -Encoding utf8 | ConvertFrom-Json",
        "$cfg | ForEach-Object {",
        "    $_.location.PSObject.Properties.Remove('_sep')",
        "    $_.location.PSObject.Properties.Remove('fsPath')",
        "    $_.location.PSObject.Properties.Remove('external')",
        "    $_.location.path = $_.location.path -replace '(?<=/).+(?=/extensions)', $data_path",
        "    if (-not $_.identifier.uuid -and $_.metadata.id) {",
        "        $_.identifier | Add-Member -NotePropertyName uuid -NotePropertyValue $_.metadata.id",
        "    }",
        "}",
        "$cfg | ConvertTo-Json -Depth 5 -Compress | Set-Content -Path $extensions_file -NoNewline -Encoding utf8"
    ],
    "post_install": [
        "$vscode_insiders_path = $dir -replace '\\\\', '\\\\'",
        "Get-ChildItem -Path \"$bucketsdir\\$bucket\\scripts\\$app\" -Filter '*.reg' -File | ForEach-Object {",
        "    $content = Get-Content -Path $_.FullName -Encoding utf8",
        "    if ($global) {",
        "        $content = $content -replace 'HKEY_CURRENT_USER', 'HKEY_LOCAL_MACHINE'",
        "        $content = $content -replace '(?<={).+(?=}_is1)', '1287CAD5-7C8D-410D-88B9-0D1EE4A83FF2'",
        "    }",
        "    $content -replace '{{vscode_insiders_dir}}', $vscode_insiders_path | Set-Content -Path \"$dir\\$($_.Name)\" -Encoding unicode",
        "}",
        "if (-not (Test-Path \"$dir\\data\\user-data\\*\") -and (Test-Path \"$env:AppData\\Code - Insiders\\*\")) {",
        "    info \"[Portable Mode] Migrating user data to '$dir\\data'...\"",
        "    Copy-Item -Path \"$env:AppData\\Code - Insiders\" -Destination \"$dir\\data\\user-data\" -Force -Recurse",
        "}",
        "'argv.json', 'extensions' | ForEach-Object {",
        "    if (-not (Test-Path \"$dir\\data\\$_\") -and (Test-Path \"$env:USERPROFILE\\.vscode-insiders\\$_\")) {",
        "        info \"[Portable Mode] Migrating $_ to '$dir\\data'...\"",
        "        Copy-Item -Path \"$env:USERPROFILE\\.vscode-insiders\\$_\" -Destination \"$dir\\data\\$_\" -Force -Recurse",
        "    }",
        "}",
        "$remove_list = 'argv.json', 'extensions' | ForEach-Object { \"$env:USERPROFILE\\.vscode-insiders\\$_\" }",
        "$remove_list + @(\"$env:AppData\\Code - Insiders\") | Remove-Item -Force -Recurse -ErrorAction SilentlyContinue",
        "$extensions_file = \"$dir\\data\\extensions\\extensions.json\"",
        "if (Test-Path $extensions_file) {",
        "    info 'Adjusting path in extensions file...'",
        "    $cfg = Get-Content -Path $extensions_file -Encoding utf8",
        "    $replace_regex = '(?<=vscode[/\\\\]+)[\\d.]+(?=[/\\\\]+data[/\\\\]+extensions)'",
        "    $cfg -replace $replace_regex, $version | Set-Content -Path $extensions_file -NoNewline -Encoding utf8",
        "}"
    ],
    "env_add_path": "bin",
    "shortcuts": [
        [
            "Code - Insiders.exe",
            "Visual Studio Code - Insiders"
        ]
    ],
    "persist": "data",
    "uninstaller": {
        "script": [
            "if ($cmd -eq 'uninstall') {",
            "    reg import \"$dir\\unregister-context-menu.reg\" *> $null",
            "    reg import \"$dir\\unregister-file-associations.reg\" *> $null",
            "    reg import \"$dir\\unregister-installed-program.reg\" *> $null",
            "}"
        ]
    },
    "checkver": {
        "url": "https://update.code.visualstudio.com/api/update/win32-x64-archive/insider/latest",
        "jsonpath": "$.url",
        "regex": "/(?<commit>(?<suffix>[a-f0-9]{7})[^/]+)/VSCode-win32-x64-(?<prefix>[\\d.]+)",
        "replace": "${prefix}-${suffix}"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/$matchCommit/VSCode-win32-x64-$matchHead-insider.zip",
                "hash": {
                    "url": "https://update.code.visualstudio.com/api/update/win32-x64-archive/insider/latest",
                    "jsonpath": "$.sha256hash"
                }
            },
            "arm64": {
                "url": "https://vscode.download.prss.microsoft.com/dbazure/download/insider/$matchCommit/VSCode-win32-arm64-$matchHead-insider.zip",
                "hash": {
                    "url": "https://update.code.visualstudio.com/api/update/win32-arm64-archive/insider/latest",
                    "jsonpath": "$.sha256hash"
                }
            }
        }
    }
}
