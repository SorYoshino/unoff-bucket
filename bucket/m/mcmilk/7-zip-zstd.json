{
    "version": "25.01-1.5.7-r3",
    "description": "7-Zip Zstandard is a multi-format file archiver based on 7-Zip that adds support for modern compression codecs including Zstandard, Brotli, LZ4, LZ5, Lizard, and Fast-LZMA2 while maintaining high compression ratios.",
    "homepage": "https://mcmilk.de/projects/7-Zip-zstd/",
    "license": {
        "identifier": "BSD-2-Clause, BSD-3-Clause, LGPL-2.1-or-later",
        "url": "https://github.com/mcmilk/7-Zip-zstd/blob/HEAD/COPYING"
    },
    "notes": [
        "To register file associations, please execute the following command:",
        "- `reg import \"$dir\\register-file-associations.reg\"`",
        "To register the context menu entry, please execute the following command:",
        "- `reg import \"$dir\\register-context-menu.reg\"`"
    ],
    "architecture": {
        "64bit": {
            "url": "https://github.com/mcmilk/7-Zip-zstd/releases/download/v25.01-v1.5.7-R3/7z25.01-zstd-x64.exe",
            "hash": "cb68843e7fca0a645d52e4193e8071c8fc0741a2fe3121a11e4452e31607af7f"
        },
        "32bit": {
            "url": "https://github.com/mcmilk/7-Zip-zstd/releases/download/v25.01-v1.5.7-R3/7z25.01-zstd-x32.exe",
            "hash": "e6de9e03016311665319614c3b831351c582a4c99b9035852dbf3398addf5e14"
        },
        "arm64": {
            "url": "https://github.com/mcmilk/7-Zip-zstd/releases/download/v25.01-v1.5.7-R3/7z25.01-zstd-arm64.exe",
            "hash": "82dd2ae09a8db928ea102b261c6906a1d00a1a7f01c9779ee26db6d801d704a2"
        }
    },
    "installer": {
        "script": "Expand-7zipArchive -Path \"$dir\\$fname\" -DestinationPath $dir -Switches '-xr!$* -xr!unins*' -Removal"
    },
    "post_install": [
        "$7zip_zstd_dir = $dir -replace '\\\\', '\\\\'",
        "Get-ChildItem -Path \"$bucketsdir\\$bucket\\scripts\\$app\" -Filter '*.reg' -File | ForEach-Object -Process {",
        "    $content = Get-Content -Path $_.FullName -Encoding utf8",
        "    if ($global) { $content = $content -replace 'HKEY_CURRENT_USER(?=.+Classes)', 'HKEY_LOCAL_MACHINE' }",
        "    $content -replace '{{7zip_zstd_dir}}', $7zip_zstd_dir | Set-Content -Path \"$dir\\$($_.Name)\" -Encoding unicode",
        "}"
    ],
    "bin": [
        "7z.exe",
        "7za.exe",
        "7zG.exe",
        "7zFM.exe"
    ],
    "shortcuts": [
        [
            "7-zip.chm",
            "7-Zip-Zstandard\\7-Zip Help"
        ],
        [
            "7zFM.exe",
            "7-Zip-Zstandard\\7-Zip ZS File Manager"
        ]
    ],
    "persist": [
        "Codecs",
        "Formats"
    ],
    "pre_uninstall": [
        "Stop-Process -Name 'explorer' -Force -ErrorAction SilentlyContinue",
        "Start-Sleep -Milliseconds 1500"
    ],
    "uninstaller": {
        "script": [
            "if ($cmd -eq 'uninstall') {",
            "    reg import \"$dir\\unregister-context-menu.reg\" *> $null",
            "    reg import \"$dir\\unregister-file-associations.reg\" *> $null",
            "}"
        ]
    },
    "checkver": {
        "url": "https://api.github.com/repositories/61958135/releases/latest",
        "jsonpath": "$.assets[?(@.name =~ /7z(?!.+ndm)/i)].browser_download_url",
        "regex": "(?i)download/(?<tag>v?(?<sevenzip>[^-]+)-v?(?<zstd>[^-]+)-R(?<release>\\d+))/(?<prefix>[^\"]+)-(?:arm|x)",
        "replace": "${sevenzip}-${zstd}-r${release}"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://github.com/mcmilk/7-Zip-zstd/releases/download/$matchTag/$matchPrefix-x64.exe"
            },
            "32bit": {
                "url": "https://github.com/mcmilk/7-Zip-zstd/releases/download/$matchTag/$matchPrefix-x32.exe"
            },
            "arm64": {
                "url": "https://github.com/mcmilk/7-Zip-zstd/releases/download/$matchTag/$matchPrefix-arm64.exe"
            }
        }
    }
}
