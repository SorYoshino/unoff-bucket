{
    "version": "1.109.1",
    "description": "Visual Studio Code is a lightweight yet powerful, cross-platform source code editor providing rich support for development, debugging, and extension-based customization for modern web and cloud workloads.",
    "homepage": "https://code.visualstudio.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://code.visualstudio.com/License"
    },
    "notes": [
        "To register file associations, please execute the following command:",
        "- `reg import \"$dir\\register-file-associations.reg\"`",
        "To register the context menu entry, please execute the following command:",
        "- `reg import \"$dir\\register-context-menu.reg\"`",
        "To register the installed program entry (required for integration with other applications), please execute the following command:",
        "- `reg import \"$dir\\register-installed-program.reg\"`"
    ],
    "architecture": {
        "64bit": {
            "url": "https://update.code.visualstudio.com/1.109.1/win32-x64-archive/stable#/dl.7z",
            "hash": "699d30098ebbcbbbb792f5d530e6cd600e123cafe15f9f590b66e42d961dfc84"
        },
        "arm64": {
            "url": "https://update.code.visualstudio.com/1.109.1/win32-arm64-archive/stable#/dl.7z",
            "hash": "c2050cf4ee60c6179150bd6a6f66b242def32f19ec22f31a879c52da91d35792"
        }
    },
    "pre_install": [
        "ensure \"$dir\\resources\\app\\resources\\win32\" | Out-Null",
        "$build_dir = Get-ChildItem -Path $dir -Directory |",
        "        Where-Object { $_.Name -match '^[a-f0-9]{7,}$' } | Select-Object -ExpandProperty FullName -First 1",
        "if (-not [string]::IsNullOrWhiteSpace($build_dir) -and (Test-Path -Path \"$build_dir\\resources\\app\\resources\\win32\\*\")) {",
        "    $resources_dir = \"$dir\\resources\\app\\resources\\win32\"",
        "    $original_resources_dir = \"$build_dir\\resources\\app\\resources\\win32\"",
        "    Copy-Item -Path \"$original_resources_dir\\*\" -Destination \"$dir\\resources\\app\\resources\\win32\" -Force",
        "}",
        "$data_dir = \"$dir\\data\" -replace '\\\\', '/'",
        "$extensions_file = \"$env:USERPROFILE\\.vscode\\extensions\\extensions.json\"",
        "if (-not (Test-Path -Path $extensions_file -PathType Leaf)) { return }",
        "$cfg = Get-Content -Path $extensions_file -Encoding utf8 | ConvertFrom-Json",
        "$cfg | ForEach-Object -Process {",
        "    $_.location.PSObject.Properties.Remove('_sep')",
        "    $_.location.PSObject.Properties.Remove('fsPath')",
        "    $_.location.PSObject.Properties.Remove('external')",
        "    $_.location.path = $_.location.path -replace '(?<=/).+(?=/extensions)', $data_dir",
        "    if (-not $_.identifier.uuid -and $_.metadata.id) {",
        "        $_.identifier | Add-Member -NotePropertyName uuid -NotePropertyValue $_.metadata.id",
        "    }",
        "}",
        "$cfg | ConvertTo-Json -Depth 5 -Compress | Set-Content -Path $extensions_file -NoNewline -Encoding utf8"
    ],
    "post_install": [
        "$vscode_dir = $dir -replace '\\\\', '\\\\'",
        "Get-ChildItem -Path \"$bucketsdir\\$bucket\\scripts\\$app\" -Filter '*.reg' -File | ForEach-Object -Process {",
        "    $content = Get-Content -Path $_.FullName -Encoding utf8",
        "    if ($global) {",
        "        $content = $content -replace 'HKEY_CURRENT_USER', 'HKEY_LOCAL_MACHINE'",
        "        $content = $content -replace '(?<={).+(?=}_is1)', 'EA457B21-F73E-494C-ACAB-524FDE069978'",
        "    }",
        "    $content -replace '{{vscode_dir}}', $vscode_dir | Set-Content -Path \"$dir\\$($_.Name)\" -Encoding unicode",
        "}",
        "if (-not (Test-Path -Path \"$dir\\data\\user-data\\*\") -and (Test-Path -Path \"$env:AppData\\Code\\*\")) {",
        "    Write-Host \"`nINFO  Migrating user data to '$dir\\data'...\" -ForegroundColor DarkGray",
        "    Copy-Item -Path \"$env:AppData\\Code\\*\" -Destination \"$dir\\data\\user-data\" -Force -Recurse",
        "}",
        "'argv.json', 'extensions' | ForEach-Object -Process {",
        "    if (-not (Test-Path -Path \"$dir\\data\\$_\") -and (Test-Path -Path \"$env:USERPROFILE\\.vscode\\$_\")) {",
        "        Write-Host \"INFO  Migrating $_ to '$dir\\data'...\" -ForegroundColor DarkGray",
        "        Copy-Item -Path \"$env:USERPROFILE\\.vscode\\$_\" -Destination \"$dir\\data\\$_\" -Force -Recurse",
        "    }",
        "}",
        "$remove_list = @('argv.json', 'extensions') | ForEach-Object -Process { \"$env:USERPROFILE\\.vscode\\$_\" }",
        "$remove_list + @(\"$env:AppData\\Code\") | Remove-Item -Recurse -Force -ErrorAction SilentlyContinue",
        "$extensions_file = \"$dir\\data\\extensions\\extensions.json\"",
        "if (Test-Path -Path $extensions_file -PathType Leaf) {",
        "    Write-Host \"`nINFO  Adjusting path in extensions file...\" -ForegroundColor DarkGray",
        "    $cfg = Get-Content -Path $extensions_file -Encoding utf8",
        "    $replace_regex = '(?<=vscode[/\\\\]+)[\\d.]+(?=[/\\\\]+data[/\\\\]+extensions)'",
        "    $cfg -replace $replace_regex, $version | Set-Content -Path $extensions_file -NoNewline -Encoding utf8",
        "}"
    ],
    "env_add_path": "bin",
    "shortcuts": [
        [
            "Code.exe",
            "Visual Studio Code"
        ]
    ],
    "persist": "data",
    "uninstaller": {
        "script": [
            "if ($cmd -ne 'uninstall') { return }",
            "Get-ChildItem -Path $dir -Filter 'un*.reg' -File | ForEach-Object -Process {",
            "    $registry_file = \"`\"{0}`\"\" -f $_.FullName",
            "    Start-Process -FilePath 'reg.exe' -ArgumentList @('import', $registry_file) -WindowStyle Hidden -Wait",
            "}"
        ]
    },
    "checkver": {
        "url": "https://update.code.visualstudio.com/api/update/win32-x64-archive/stable/latest",
        "jsonpath": "$.productVersion"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://update.code.visualstudio.com/$version/win32-x64-archive/stable#/dl.7z",
                "hash": {
                    "url": "https://update.code.visualstudio.com/api/versions/$version/win32-x64-archive/stable",
                    "jsonpath": "$.sha256hash"
                }
            },
            "arm64": {
                "url": "https://update.code.visualstudio.com/$version/win32-arm64-archive/stable#/dl.7z",
                "hash": {
                    "url": "https://update.code.visualstudio.com/api/versions/$version/win32-arm64-archive/stable",
                    "jsonpath": "$.sha256hash"
                }
            }
        }
    }
}
