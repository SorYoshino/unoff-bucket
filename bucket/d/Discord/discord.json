{
    "version": "1.0.9219",
    "description": "A voice, video and text communication platform.",
    "homepage": "https://discord.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://discord.com/terms"
    },
    "architecture": {
        "64bit": {
            "url": "https://stable.dl2.discordapp.net/distro/app/stable/win/x64/1.0.9219/DiscordSetup.exe",
            "hash": "fd0f891e4d72bf23eb5f4bd79e9ffe85a4fe224df48ab021a4eae8e5422f4c2b"
        }
    },
    "installer": {
        "script": [
            "Expand-7zipArchive -Path \"$dir\\$fname\" -DestinationPath $dir -Removal",
            "$nupkg_file = Get-ChildItem -Path $dir -Filter '*.nupkg' -File | ForEach-Object -MemberName FullName",
            "Expand-7zipArchive -Path $nupkg_file -DestinationPath \"$dir\\app-$version\" -ExtractDir 'lib\\net45' -Removal",
            "Move-Item -Path \"$dir\\app-$version\\installer.db\" -Destination $dir -Force",
            "Copy-Item -Path \"$dir\\app-$version\\app.ico\" -Destination $dir",
            "New-Item -Path \"$dir\\packages\" -ItemType Directory -Force | Out-Null",
            "Move-Item -Path \"$dir\\RELEASES\" -Destination \"$dir\\packages\" -Force"
        ]
    },
    "shortcuts": [
        [
            "Update.exe",
            "Discord",
            "--processStart Discord.exe",
            "app.ico"
        ]
    ],
    "checkver": {
        "script": [
            "$params = @{ channel = 'stable'; platform = 'win'; arch = 'x64' }",
            "$base_url = 'https://discord.com/api/downloads/distributions/app/installers/latest'",
            "$query_string = ($params.GetEnumerator() | ForEach-Object -Process { \"$($_.Key)=$($_.Value)\" }) -join '&'",
            "$download_url = $base_url + '?' + $query_string",
            "$http_handler = New-Object -TypeName System.Net.Http.HttpClientHandler",
            "$http_handler.AllowAutoRedirect = $true",
            "$client = [System.Net.Http.HttpClient]::new($http_handler)",
            "$request = New-Object -TypeName System.Net.Http.HttpRequestMessage -ArgumentList 'HEAD', $download_url",
            "$response = $client.SendAsync($request).Result",
            "Write-Output $response.RequestMessage.RequestUri.AbsoluteUri"
        ],
        "regex": "x64/([\\d.]+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://stable.dl2.discordapp.net/distro/app/stable/win/x64/$version/DiscordSetup.exe"
            }
        }
    }
}
