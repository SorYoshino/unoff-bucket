{
    "version": "4.6.6",
    "description": "Overclocking utility for graphics cards. Main features include GPU/Shader/Memory clock adjustment, advanced fan speed and GPU voltage control.",
    "homepage": "https://www.msi.com/Landing/afterburner/graphics-cards",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.msi.com/page/website-terms-of-use"
    },
    "suggest": {
        "FurMark": "extras/furmark",
        "MSI Kombustor": "extras/msikombustor",
        "RivaTuner Statistics Server": "extras/rtss",
        "Microsoft Visual C++ 2015-2022 Redistributable": "extras/vcredist2022"
    },
    "url": "https://ftp.nluug.nl/pub/games/PC/guru3d/afterburner/%5BGuru3D%5D-MSIAfterburnerSetup466Build16757.zip#/dl.7z_",
    "hash": "348e9690a638d84e30e32e9c7c2dd7aad9fd82d71eced1942c04c4c5620b0e1e",
    "installer": {
        "script": [
            "Expand-7zipArchive -Path \"$dir\\$fname\" -DestinationPath \"$dir\\tmp\" -Removal",
            "$installer_file = Get-ChildItem -Path \"$dir\\tmp\" -Filter '*.exe' -File | ForEach-Object -MemberName FullName",
            "Expand-7zipArchive -Path $installer_file -Switches '-xr!$* -xr!unins* -x!Redist' -Removal",
            "Remove-Item -Path \"$dir\\tmp\" -Recurse -Force -ErrorAction SilentlyContinue"
        ]
    },
    "bin": "MSIAfterburner.exe",
    "shortcuts": [
        [
            "MSIAfterburner.exe",
            "MSI Afterburner"
        ]
    ],
    "persist": "Profiles",
    "checkver": {
        "url": "https://www.guru3d.com/download/msi-afterburner-beta-download",
        "script": [
            "if ($page -match 'aform.*?value=\"(?<token>[0-9a-f]+)\".*?Download (?<version>[\\d.]+)') {",
            "    $version = $Matches['version']",
            "    $body = @{ aform = $Matches['token'] }",
            "    $post_response = Invoke-WebRequest -Uri $url -Method Post -Body $body -ErrorAction Stop",
            "    if ($post_response.Content -match 'location=\"(?<redirect_url>https://www.guru3d.com/getdownload/[0-9a-f]+)\"') {",
            "        $request_params = @{ Uri = $Matches.redirect_url; MaximumRedirection = 0 }",
            "        if ($PSVersionTable.PSVersion -ge [version]::new(7, 0)) { $request_params['SkipHttpErrorCheck'] = $true }",
            "        $response = Invoke-WebRequest @request_params -ErrorAction SilentlyContinue",
            "        $path_segments = $response.Headers.Location -replace '.+?guru3d/', ''",
            "        Write-Output \"$version, $([System.Net.WebUtility]::UrlEncode($path_segments))\"",
            "    }",
            "}"
        ],
        "regex": "([\\d.]+), (?<path>[^%]+)%2F(?<name>.+)"
    },
    "autoupdate": {
        "url": "https://ftp.nluug.nl/pub/games/PC/guru3d/$matchPath/$matchName#/dl.7z_"
    }
}
