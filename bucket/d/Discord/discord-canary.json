{
    "version": "1.0.807",
    "description": "A voice, video, and text communication platform, serving as the bleeding-edge testing environment for the latest features and architectural updates.",
    "homepage": "https://discord.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://discord.com/terms"
    },
    "architecture": {
        "64bit": {
            "url": "https://canary.dl2.discordapp.net/distro/app/canary/win/x64/1.0.807/DiscordCanarySetup.exe",
            "hash": "3fde155e1992abdc3f7de04e50b68dad5fc43d493122f1116d3fcd42ae4fc605"
        }
    },
    "installer": {
        "script": [
            "ensure \"$dir\\packages\" | Out-Null",
            "Expand-7zipArchive -Path \"$dir\\$fname\" -Removal",
            "$archive_file = Get-ChildItem -Path $dir -Filter '*.nupkg' -File | ForEach-Object -MemberName FullName",
            "Expand-7zipArchive -Path $archive_file -DestinationPath \"$dir\\app-$version\" -ExtractDir 'lib\\net45' -Removal",
            "Move-Item -Path \"$dir\\app-$version\\installer.db\" -Destination $dir -Force",
            "Move-Item -Path \"$dir\\RELEASES\" -Destination \"$dir\\packages\" -Force",
            "Copy-Item -Path \"$dir\\app-$version\\app.ico\" -Destination $dir"
        ]
    },
    "shortcuts": [
        [
            "Update.exe",
            "Discord Canary",
            "--processStart DiscordCanary.exe",
            "app.ico"
        ]
    ],
    "checkver": {
        "script": [
            "$params = @{ channel = 'canary'; platform = 'win'; arch = 'x64' }",
            "$base_url = 'https://discord.com/api/downloads/distributions/app/installers/latest'",
            "$query_string = ($params.GetEnumerator() | ForEach-Object -Process { \"$($_.Key)=$($_.Value)\" }) -join '&'",
            "$download_url = $base_url + '?' + $query_string",
            "$http_handler = New-Object -TypeName System.Net.Http.HttpClientHandler",
            "$http_handler.AllowAutoRedirect = $true",
            "$client = [System.Net.Http.HttpClient]::new($http_handler)",
            "$request = New-Object -TypeName System.Net.Http.HttpRequestMessage -ArgumentList 'HEAD', $download_url",
            "$response = $client.SendAsync($request).Result",
            "Write-Output $response.RequestMessage.RequestUri.AbsoluteUri"
        ],
        "regex": "x64/([\\d.]+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://canary.dl2.discordapp.net/distro/app/canary/win/x64/$version/DiscordCanarySetup.exe"
            }
        }
    }
}
