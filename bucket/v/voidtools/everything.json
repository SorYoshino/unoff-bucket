{
    "version": "1.4.1.1032",
    "description": "A file and folder search engine for Windows that instantly locates files and folders by name.",
    "homepage": "https://www.voidtools.com",
    "license": {
        "identifier": "MIT",
        "url": "https://www.voidtools.com/License.txt"
    },
    "notes": [
        "To register file associations, please execute the following command:",
        "- `reg import \"$dir\\register-file-associations.reg\"`",
        "To register application startup, please execute the following command:",
        "- `reg import \"$dir\\register-startup-entry.reg\"`",
        "To register the context menu entry, please execute the following command:",
        "- `reg import \"$dir\\register-context-menu.reg\"`",
        "To register the URL protocol handler, please execute the following command:",
        "- `reg import \"$dir\\register-url-handler.reg\"`"
    ],
    "architecture": {
        "64bit": {
            "url": "https://www.voidtools.com/Everything-1.4.1.1032.x64.zip",
            "hash": "698df475ec44e638f66f1b6a32d28fea613cec78d3b6310e6abe53431eeb940c"
        },
        "32bit": {
            "url": "https://www.voidtools.com/Everything-1.4.1.1032.x86.zip",
            "hash": "156db5beb747d69470518a7b9b55af11efc4d3285ddb7cc013c0cc13ced5f237"
        }
    },
    "pre_install": [
        "Get-ChildItem -Path $dir -Filter '*.exe' -File | ForEach-Object -Process {",
        "    $new_name = [regex]::Replace($_.BaseName, '^([a-z])([^A-Z]*).*', {",
        "            $args[0].Groups[1].Value.ToUpper() + $args[0].Groups[2].Value + '.exe'",
        "        })",
        "    if ($_.Name -cne $new_name) { $_ | Rename-Item -NewName $new_name -Force }",
        "}",
        "if (-not (Test-Path -Path \"$persist_dir\\*\" -Include '*.ini' -PathType Leaf)) {",
        "    Start-Process -FilePath \"$dir\\Everything.exe\" -ArgumentList @('-install-config', 'null') -NoNewWindow -Wait",
        "}",
        "# Hard links are not applicable here because the application creates a new file instead of modifying the existing one in place.",
        "if ($cmd -eq 'install' -and -not (Test-Path -Path \"$persist_dir\\*\")) { return }",
        "'*.db', '*.csv', '*.ico', '*.ini', '*.txt' | ForEach-Object -Process {",
        "    if (Test-Path -Path \"$persist_dir\\$_\" -PathType Leaf) {",
        "        Copy-Item -Path \"$persist_dir\\$_\" -Destination $dir -Force",
        "    }",
        "}"
    ],
    "post_install": [
        "$everything_dir = $dir -replace '\\\\', '\\\\'",
        "Get-ChildItem -Path \"$bucketsdir\\$bucket\\scripts\\$app\" -Filter '*.reg' -File | ForEach-Object -Process {",
        "    $content = Get-Content -Path $_.FullName -Encoding utf8",
        "    if ($global) { $content = $content -replace 'HKEY_CURRENT_USER', 'HKEY_LOCAL_MACHINE' }",
        "    $content -replace '{{everything_dir}}', $everything_dir | Set-Content -Path \"$dir\\$($_.Name)\" -Encoding unicode",
        "}"
    ],
    "bin": "Everything.exe",
    "shortcuts": [
        [
            "Everything.exe",
            "Everything"
        ]
    ],
    "persist": [
        "Logs",
        "HTTP server"
    ],
    "pre_uninstall": [
        "# Hard links are not applicable here because the application creates a new file instead of modifying the existing one in place.",
        "if ($cmd -eq 'uninstall' -and $purge) { return }",
        "'*.db', '*.csv', '*.ico', '*.ini', '*.txt' | ForEach-Object -Process {",
        "    if (Test-Path -Path \"$dir\\$_\" -PathType Leaf) {",
        "        Copy-Item -Path \"$dir\\$_\" -Destination $persist_dir -Force",
        "    }",
        "}"
    ],
    "uninstaller": {
        "script": [
            "if ($cmd -eq 'uninstall') {",
            "    Get-ChildItem -Path $dir -Filter 'un*.reg' -File | ForEach-Object {",
            "        $registry_file = \"`\"{0}`\"\" -f $_.FullName",
            "        Start-Process -FilePath 'reg.exe' -ArgumentList @('import', $registry_file) -WindowStyle Hidden -Wait",
            "    }",
            "}",
            "$base_service_name = 'Everything'",
            "$path_regex = [regex]::Escape((Split-Path -Path $dir -Parent))",
            "Stop-Process -Name 'Everything' -Force -ErrorAction SilentlyContinue",
            "if ($PSVersionTable.PSVersion -ge [version]::new(6, 0)) {",
            "    $services = Get-Service -Name \"*$base_service_name*\" -ErrorAction SilentlyContinue",
            "} else {",
            "    $name_filter = \"Name like '%$base_service_name%'\"",
            "    $services = Get-CimInstance -ClassName Win32_Service -Filter $name_filter -ErrorAction SilentlyContinue |",
            "            Select-Object -Property *, @{ Name = 'BinaryPathName'; Expression = { $_.PathName } }",
            "}",
            "$service = $services | Where-Object { $_.BinaryPathName -match $path_regex }",
            "if ($null -ne $service) {",
            "    if (-not (is_admin)) { abort \"`n[ERROR]  $app requires admin rights to $cmd.\" }",
            "    Stop-Service -Name $service.Name -Force -ErrorAction SilentlyContinue",
            "    Stop-Process -Name 'Everything' -Force -ErrorAction SilentlyContinue",
            "    Start-Sleep -Milliseconds 1500",
            "    if ($cmd -ne 'uninstall') { return }",
            "    if ($PSVersionTable.PSVersion -ge [version]::new(6, 0)) {",
            "        Remove-Service -Name 'Everything' -ErrorAction SilentlyContinue",
            "    } else {",
            "        Start-Process -FilePath 'sc.exe' -ArgumentList @('delete', 'Everything') -NoNewWindow -Wait",
            "    }",
            "}"
        ]
    },
    "checkver": {
        "url": "https://www.voidtools.com/Changes.txt",
        "regex": "Version\\s*([\\d.]+)(?=\\s)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://www.voidtools.com/Everything-$version.x64.zip"
            },
            "32bit": {
                "url": "https://www.voidtools.com/Everything-$version.x86.zip"
            }
        },
        "hash": {
            "url": "$baseurl/Everything-$version.sha256"
        }
    }
}
