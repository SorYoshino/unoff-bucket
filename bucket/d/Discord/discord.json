{
    "version": "1.0.9222",
    "description": "A voice, video and text communication platform.",
    "homepage": "https://discord.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://discord.com/terms"
    },
    "architecture": {
        "64bit": {
            "url": "https://stable.dl2.discordapp.net/distro/app/stable/win/x64/1.0.9222/DiscordSetup.exe",
            "hash": "9ab8ef10e60662a90d5ba4bc43337bbe050012b80f9dbb7ece39aa8b51ae474b"
        }
    },
    "installer": {
        "script": [
            "ensure \"$dir\\packages\" | Out-Null",
            "Expand-7zipArchive -Path \"$dir\\$fname\" -Removal",
            "$archive_file = Get-ChildItem -Path $dir -Filter '*.nupkg' -File | ForEach-Object -MemberName FullName",
            "Expand-7zipArchive -Path $archive_file -DestinationPath \"$dir\\app-$version\" -ExtractDir 'lib\\net45' -Removal",
            "Move-Item -Path \"$dir\\app-$version\\installer.db\" -Destination $dir -Force",
            "Move-Item -Path \"$dir\\RELEASES\" -Destination \"$dir\\packages\" -Force",
            "Copy-Item -Path \"$dir\\app-$version\\app.ico\" -Destination $dir"
        ]
    },
    "shortcuts": [
        [
            "Update.exe",
            "Discord",
            "--processStart Discord.exe",
            "app.ico"
        ]
    ],
    "checkver": {
        "script": [
            "if ($PSVersionTable.PSVersion -lt [version]::new(7, 0)) { Add-Type -AssemblyName System.Net.Http }",
            "$params = [ordered]@{ channel = 'stable'; platform = 'win'; arch = 'x64' }",
            "$base_url = 'https://discord.com/api/downloads/distributions/app/installers/latest'",
            "$query_string = ($params.Keys | ForEach-Object -Process { \"$_=$($params[$_])\" }) -join '&'",
            "$download_url = $base_url + '?' + $query_string",
            "$http_handler = New-Object -TypeName System.Net.Http.HttpClientHandler",
            "$http_handler.AllowAutoRedirect = $true",
            "$client = [System.Net.Http.HttpClient]::new($http_handler)",
            "$request = New-Object -TypeName System.Net.Http.HttpRequestMessage -ArgumentList 'HEAD', $download_url",
            "$response = $client.SendAsync($request).Result",
            "Write-Output $response.RequestMessage.RequestUri.AbsoluteUri",
            "$response, $request, $client, $http_handler | Where-Object { $null -ne $_ } | ForEach-Object -Process { $_.Dispose() }"
        ],
        "regex": "x64/([\\d.]+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://stable.dl2.discordapp.net/distro/app/stable/win/x64/$version/DiscordSetup.exe"
            }
        }
    }
}
